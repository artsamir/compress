{% extends 'base.html' %}
{% block title %}Word Counter - Character, Word, Sentence Counter{% endblock %}
{% block description %}Count words, characters, sentences, and paragraphs. Free online text analyzer with reading time estimation.{% endblock %}
{% block keywords %}word counter, character counter, sentence counter, text analyzer, reading time{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tools_common.css') }}">
<script src="{{ url_for('static', filename='js/tools_common.js') }}"></script>
{% endblock %}

{% block content %}
<div class="tool-page">
    <button class="theme-toggle" onclick="toggleTheme()">
        <span class="icon-sun">‚òÄÔ∏è</span>
        <span class="icon-moon">üåô</span>
    </button>

    <div class="tool-container">
        <div class="tool-header">
            <div class="emoji-icon">üìä</div>
            <h1>Word Counter</h1>
            <p>Analyze your text with detailed statistics! ‚ú®</p>
        </div>

        <div class="instructions-card">
            <h3>üìã How to Use</h3>
            <ol>
                <li><strong>Type</strong> or paste your text in the editor</li>
                <li><strong>View</strong> real-time statistics</li>
                <li><strong>Analyze</strong> word frequency and more</li>
                <li><strong>Copy</strong> or export your text!</li>
            </ol>
        </div>

        <div class="tool-card">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">üìù</span>
                    <span class="stat-value" id="wordCount">0</span>
                    <span class="stat-label">Words</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üî§</span>
                    <span class="stat-value" id="charCount">0</span>
                    <span class="stat-label">Characters</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üî°</span>
                    <span class="stat-value" id="charNoSpaceCount">0</span>
                    <span class="stat-label">Chars (no spaces)</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üìñ</span>
                    <span class="stat-value" id="sentenceCount">0</span>
                    <span class="stat-label">Sentences</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üìÑ</span>
                    <span class="stat-value" id="paragraphCount">0</span>
                    <span class="stat-label">Paragraphs</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span class="stat-value" id="readingTime">0</span>
                    <span class="stat-label">Min read</span>
                </div>
            </div>

            <!-- Text Editor -->
            <div style="margin-top: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <h4 style="color: var(--text-primary); margin: 0;">‚úèÔ∏è Your Text</h4>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="clearText()" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">üóëÔ∏è Clear</button>
                        <button class="btn btn-secondary" onclick="copyText()" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">üìã Copy</button>
                    </div>
                </div>
                <textarea id="textInput" placeholder="Start typing or paste your text here..." oninput="analyzeText()" style="width: 100%; height: 300px; font-family: 'Georgia', serif; font-size: 16px; line-height: 1.8; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); resize: vertical;"></textarea>
            </div>

            <!-- Text Tools -->
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="transformText('upper')">UPPERCASE</button>
                <button class="btn btn-secondary" onclick="transformText('lower')">lowercase</button>
                <button class="btn btn-secondary" onclick="transformText('title')">Title Case</button>
                <button class="btn btn-secondary" onclick="transformText('sentence')">Sentence case</button>
                <button class="btn btn-secondary" onclick="transformText('reverse')">esreveR</button>
                <button class="btn btn-secondary" onclick="removeExtraSpaces()">Remove Extra Spaces</button>
            </div>
        </div>

        <!-- Advanced Analysis -->
        <div class="tool-card" style="margin-top: 1.5rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">üìà Advanced Analysis</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <!-- Word Frequency -->
                <div>
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">üî¢ Top Words</h4>
                    <div id="wordFrequency" style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; max-height: 250px; overflow-y: auto;">
                        <p style="color: var(--text-secondary);">Enter text to see word frequency</p>
                    </div>
                </div>

                <!-- Text Info -->
                <div>
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">üìä Text Details</h4>
                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;">
                        <div class="detail-row">
                            <span>Average word length</span>
                            <span id="avgWordLength">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Average sentence length</span>
                            <span id="avgSentenceLength">0 words</span>
                        </div>
                        <div class="detail-row">
                            <span>Longest word</span>
                            <span id="longestWord">-</span>
                        </div>
                        <div class="detail-row">
                            <span>Unique words</span>
                            <span id="uniqueWords">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Speaking time</span>
                            <span id="speakingTime">0 min</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Character Breakdown -->
            <div style="margin-top: 1.5rem;">
                <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">üî§ Character Breakdown</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div class="char-stat">
                        <span class="char-count" id="letterCount">0</span>
                        <span class="char-label">Letters</span>
                    </div>
                    <div class="char-stat">
                        <span class="char-count" id="digitCount">0</span>
                        <span class="char-label">Digits</span>
                    </div>
                    <div class="char-stat">
                        <span class="char-count" id="spaceCount">0</span>
                        <span class="char-label">Spaces</span>
                    </div>
                    <div class="char-stat">
                        <span class="char-count" id="punctuationCount">0</span>
                        <span class="char-label">Punctuation</span>
                    </div>
                    <div class="char-stat">
                        <span class="char-count" id="lineCount">0</span>
                        <span class="char-label">Lines</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Find & Replace -->
        <div class="tool-card" style="margin-top: 1.5rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">üîç Find & Replace</h3>
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>Find</label>
                    <input type="text" id="findText" placeholder="Text to find">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Replace with</label>
                    <input type="text" id="replaceText" placeholder="Replace with">
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn btn-primary" onclick="findAndReplace()">Replace All</button>
                </div>
            </div>
            <div style="margin-top: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                    <input type="checkbox" id="caseSensitive" style="width: auto;">
                    Case sensitive
                </label>
            </div>
        </div>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
}
.stat-card {
    background: var(--bg-tertiary);
    padding: 1.25rem;
    border-radius: 12px;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}
.stat-icon {
    font-size: 1.5rem;
}
.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent-color);
}
.stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
}
.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-secondary);
}
.detail-row:last-child {
    border-bottom: none;
}
.detail-row span:last-child {
    color: var(--text-primary);
    font-weight: 500;
}
.char-stat {
    background: var(--bg-tertiary);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    text-align: center;
}
.char-count {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent-color);
    display: block;
}
.char-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
}
.word-freq-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem;
    border-radius: 4px;
    margin-bottom: 0.25rem;
}
.word-freq-item:nth-child(odd) {
    background: rgba(99, 102, 241, 0.1);
}
</style>

<script>
function analyzeText() {
    const text = document.getElementById('textInput').value;
    
    // Basic counts
    const words = text.trim() ? text.trim().split(/\s+/).filter(w => w.length > 0) : [];
    const chars = text.length;
    const charsNoSpace = text.replace(/\s/g, '').length;
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
    const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 0).length;
    const readingTime = Math.ceil(words.length / 200); // 200 wpm
    
    // Update basic stats
    document.getElementById('wordCount').textContent = words.length;
    document.getElementById('charCount').textContent = chars;
    document.getElementById('charNoSpaceCount').textContent = charsNoSpace;
    document.getElementById('sentenceCount').textContent = sentences;
    document.getElementById('paragraphCount').textContent = paragraphs || (text.trim() ? 1 : 0);
    document.getElementById('readingTime').textContent = readingTime || 0;
    
    // Character breakdown
    const letters = (text.match(/[a-zA-Z]/g) || []).length;
    const digits = (text.match(/[0-9]/g) || []).length;
    const spaces = (text.match(/\s/g) || []).length;
    const punctuation = (text.match(/[.,!?;:'"()\-\[\]{}]/g) || []).length;
    const lines = text.split('\n').length;
    
    document.getElementById('letterCount').textContent = letters;
    document.getElementById('digitCount').textContent = digits;
    document.getElementById('spaceCount').textContent = spaces;
    document.getElementById('punctuationCount').textContent = punctuation;
    document.getElementById('lineCount').textContent = lines;
    
    // Advanced stats
    if (words.length > 0) {
        const avgWordLen = (words.reduce((sum, w) => sum + w.replace(/[^a-zA-Z]/g, '').length, 0) / words.length).toFixed(1);
        const avgSentLen = (words.length / Math.max(sentences, 1)).toFixed(1);
        const longest = words.reduce((a, b) => a.replace(/[^a-zA-Z]/g, '').length > b.replace(/[^a-zA-Z]/g, '').length ? a : b, '');
        const uniqueCount = new Set(words.map(w => w.toLowerCase().replace(/[^a-zA-Z]/g, ''))).size;
        const speakTime = Math.ceil(words.length / 150); // 150 wpm speaking
        
        document.getElementById('avgWordLength').textContent = avgWordLen + ' chars';
        document.getElementById('avgSentenceLength').textContent = avgSentLen + ' words';
        document.getElementById('longestWord').textContent = longest.replace(/[^a-zA-Z]/g, '') || '-';
        document.getElementById('uniqueWords').textContent = uniqueCount;
        document.getElementById('speakingTime').textContent = speakTime + ' min';
        
        // Word frequency
        const freq = {};
        words.forEach(w => {
            const clean = w.toLowerCase().replace(/[^a-zA-Z]/g, '');
            if (clean.length > 2) {
                freq[clean] = (freq[clean] || 0) + 1;
            }
        });
        
        const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]).slice(0, 10);
        document.getElementById('wordFrequency').innerHTML = sorted.length ? 
            sorted.map(([word, count]) => `
                <div class="word-freq-item">
                    <span style="color: var(--text-primary);">${word}</span>
                    <span style="color: var(--accent-color); font-weight: 600;">${count}</span>
                </div>
            `).join('') :
            '<p style="color: var(--text-secondary);">Enter more text to see frequency</p>';
    } else {
        // Reset advanced stats
        document.getElementById('avgWordLength').textContent = '0';
        document.getElementById('avgSentenceLength').textContent = '0 words';
        document.getElementById('longestWord').textContent = '-';
        document.getElementById('uniqueWords').textContent = '0';
        document.getElementById('speakingTime').textContent = '0 min';
        document.getElementById('wordFrequency').innerHTML = '<p style="color: var(--text-secondary);">Enter text to see word frequency</p>';
    }
}

function clearText() {
    document.getElementById('textInput').value = '';
    analyzeText();
}

function copyText() {
    const text = document.getElementById('textInput').value;
    if (!text) {
        CutcompressTools.showAlert('Nothing to copy', 'warning');
        return;
    }
    navigator.clipboard.writeText(text);
    CutcompressTools.showAlert('Copied to clipboard!', 'success');
}

function transformText(type) {
    const textarea = document.getElementById('textInput');
    let text = textarea.value;
    
    switch(type) {
        case 'upper':
            text = text.toUpperCase();
            break;
        case 'lower':
            text = text.toLowerCase();
            break;
        case 'title':
            text = text.toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
            break;
        case 'sentence':
            text = text.toLowerCase().replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());
            break;
        case 'reverse':
            text = text.split('').reverse().join('');
            break;
    }
    
    textarea.value = text;
    analyzeText();
    CutcompressTools.showAlert('Text transformed!', 'success');
}

function removeExtraSpaces() {
    const textarea = document.getElementById('textInput');
    textarea.value = textarea.value.replace(/\s+/g, ' ').trim();
    analyzeText();
    CutcompressTools.showAlert('Extra spaces removed!', 'success');
}

function findAndReplace() {
    const findText = document.getElementById('findText').value;
    const replaceText = document.getElementById('replaceText').value;
    const caseSensitive = document.getElementById('caseSensitive').checked;
    
    if (!findText) {
        CutcompressTools.showAlert('Enter text to find', 'warning');
        return;
    }
    
    const textarea = document.getElementById('textInput');
    const flags = caseSensitive ? 'g' : 'gi';
    const regex = new RegExp(findText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), flags);
    const matches = (textarea.value.match(regex) || []).length;
    
    textarea.value = textarea.value.replace(regex, replaceText);
    analyzeText();
    CutcompressTools.showAlert(`Replaced ${matches} occurrence(s)`, 'success');
}

// Initialize
document.addEventListener('DOMContentLoaded', analyzeText);
</script>
{% endblock %}
